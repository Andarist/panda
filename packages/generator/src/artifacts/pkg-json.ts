import { ArtifactFile } from './artifact-map'

export const packageJsonArtifact = new ArtifactFile({
  id: 'package.json',
  fileName: 'package.json',
  type: 'json',
  dir: (ctx) => ctx.paths.root,
  dependencies: ['outdir', 'emitPackage'],
  computed(ctx) {
    return {
      emitPackage: ctx.config.emitPackage,
      outdir: ctx.config.outdir,
    }
  },
  code(params) {
    if (!params.computed.emitPackage) return
    const { outdir } = params.computed

    const pkg = {
      name: outdir,
      description: 'This package is auto-generated by Panda CSS',
      version: `0.0.0-${performance.now()}`,
      type: 'module',
      exports: {
        './css': {
          types: params.file.extDts('./css/index'),
          require: params.file.ext(`./css/index`),
          import: params.file.ext(`./css/index`),
        },
        './jsx': {
          types: params.file.extDts('./jsx/index'),
          require: params.file.ext(`./jsx/index`),
          import: params.file.ext(`./jsx/index`),
        },
        './patterns': {
          types: params.file.extDts('./patterns/index'),
          require: params.file.ext(`./patterns/index`),
          import: params.file.ext(`./patterns/index`),
        },
        './recipes': {
          types: params.file.extDts('./recipes/index'),
          require: params.file.ext(`./recipes/index`),
          import: params.file.ext(`./recipes/index`),
        },
        './themes': {
          types: params.file.extDts('./themes/index'),
          require: params.file.ext(`./themes/index`),
          import: params.file.ext(`./themes/index`),
        },
        './tokens': {
          types: params.file.extDts('./tokens/index'),
          require: params.file.ext(`./tokens/index`),
          import: params.file.ext(`./tokens/index`),
        },
        './types': {
          types: params.file.extDts('./types/index'),
        },
        './styles.css': './styles.css',
      },
    }

    return JSON.stringify(pkg, null, 2)
  },
})
