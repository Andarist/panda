import { ArtifactFile } from './artifact'

export const packageJsonArtifact = new ArtifactFile({
  id: 'package.json',
  fileName: 'package.json',
  type: 'json',
  dir: (ctx) => ctx.paths.root,
  dependencies: [],
  computed(ctx) {
    return {
      outdir: ctx.config.outdir,
      ext: ctx.file.ext,
      extDts: ctx.file.extDts,
    }
  },
  code(params) {
    const { outdir, extDts, ext } = params.computed

    const pkg = {
      name: outdir,
      description: 'This package is auto-generated by Panda CSS',
      version: `0.0.0-${performance.now()}`,
      type: 'module',
      exports: {
        './css': {
          types: extDts('./css/index'),
          require: ext(`./css/index`),
          import: ext(`./css/index`),
        },
        './jsx': {
          types: extDts('./jsx/index'),
          require: ext(`./jsx/index`),
          import: ext(`./jsx/index`),
        },
        './patterns': {
          types: extDts('./patterns/index'),
          require: ext(`./patterns/index`),
          import: ext(`./patterns/index`),
        },
        './recipes': {
          types: extDts('./recipes/index'),
          require: ext(`./recipes/index`),
          import: ext(`./recipes/index`),
        },
        './themes': {
          types: extDts('./themes/index'),
          require: ext(`./themes/index`),
          import: ext(`./themes/index`),
        },
        './tokens': {
          types: extDts('./tokens/index'),
          require: ext(`./tokens/index`),
          import: ext(`./tokens/index`),
        },
        './types': {
          types: extDts('./types/index'),
        },
        './styles.css': './styles.css',
      },
    }

    return JSON.stringify(pkg, null, 2)
  },
})
